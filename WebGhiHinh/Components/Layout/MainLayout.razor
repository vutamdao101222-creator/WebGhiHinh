@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Components.Authorization
@using WebGhiHinh.Services
@inject AuthenticationStateProvider AuthStateProvider

<div class="page">
    <main>
        @Body
    </main>
</div>

@if (isLoading)
{
    <div style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(255,255,255,0.8);display:flex;justify-content:center;align-items:center;z-index:9999;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
}

@code {
    private bool isLoading = true;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // 👇 Tự động nạp lại user từ LocalStorage khi F5 trang
            if (AuthStateProvider is CustomAuthStateProvider auth)
            {
                await auth.LoadUserFromLocalStorage();
            }

            isLoading = false;
            StateHasChanged();
        }
    }
}